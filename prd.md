# 车险变动成本多维分析系统 - 产品需求文档 (PRD)

**版本: v0.1  | **最后更新**: 2025-09-16

## 🚀 AI开发快速入口

### 核心信息摘要
- **项目类型**: 车险变动成本多维分析系统
- **技术栈**: Next.js 14 + TypeScript + Recharts + Node.js
- **数据架构**: 17个筛选维度 + 9个绝对值字段 + 代码计算机制
- **数据规模**: 每周约16,000行 × 25个存储字段，支持500万级数据量
- **核心特性**: 绝对值存储 + 代码计算，确保聚合分析的准确性
- **AI功能**: 智能数据发现、异常检测、趋势预测、业务洞察

### 关键文件路径
- **CSV字段规范**: `./多维分析系统数据规范/上传CSV文件字段规范.md` - CSV文件上传的字段定义和格式要求
- **字段选项明细**: `./多维分析系统数据规范/多维分析系统字段选项明细.md` - 系统中各字段的可选值和分类标准
- **数据说明文档**: `./多维分析系统数据规范/多维分析系统数据说明.md` - 数据处理逻辑、计算方法和使用示例

### AI开发重点
1. **数据架构设计**: 基于字段分类体系（17维度+9绝对值字段+代码计算）的标准化数据处理
2. **计算引擎**: 使用Python代码计算，先聚合绝对值再计算比率，确保准确性
3. **动态适应**: 智能数据发现机制，自动适应数据结构变化，支持105周完整数据周期
4. **性能优化**: 单次查询限制15周45万条数据，响应时间<2秒，支持分片加载和缓存策略
5. **多维分析**: 支持趋势分析、对比分析、风险分析、盈利能力分析等典型业务场景

---

> **文档说明**:
> 本文档为车险多维分析系统的核心产品需求文档，包含完整的业务逻辑、功能需求和技术规格。

---

## 📚 相关文档

### 📊 数据规范文档
- **[上传CSV文件字段规范](./多维分析系统数据规范/上传CSV文件字段规范.md)** - CSV文件上传的字段定义和格式要求
- **[多维分析系统字段选项明细](./多维分析系统数据规范/多维分析系统字段选项明细.md)** - 系统中各字段的可选值和分类标准
- **[多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md)** - 数据处理逻辑、计算方法和使用示例

## 🔍 快速导航

### 按功能模块
| 模块 | 核心需求 | 数据规范 |
|------|----------|----------|
| **数据导入** | [数据导入与集成](#31-数据导入与集成) | [CSV字段规范](./多维分析系统数据规范/上传CSV文件字段规范.md) |
| **多维分析** | [成本分析仪表盘](#32-成本分析仪表盘) | [字段选项明细](./多维分析系统数据规范/多维分析系统字段选项明细.md) |
| **数据处理** | [AI核心处理逻辑](#2-ai核心处理逻辑) | [数据说明文档](./多维分析系统数据规范/多维分析系统数据说明.md) |

---

## 目录

1.  [产品概述](#1-产品概述)
    -   [1.1 项目背景](#11-项目背景)
    -   [1.2 核心目标](#12-核心目标)
    -   [1.3 关键指标](#13-关键指标)
2.  [AI核心处理逻辑](#2-ai核心处理逻辑)
    -   [2.1 数据预处理与转换](#21-数据预处理与转换)
    -   [2.2 指标计算引擎](#22-指标计算引擎)
    -   [2.3 智能分析与洞察](#23-智能分析与洞察)
3.  [核心功能需求](#3-核心功能需求)
    -   [3.1 数据导入与集成](#31-数据导入与集成)
    -   [3.2 成本分析仪表盘](#32-成本分析仪表盘)
    -   [3.3 风险预警与监控](#33-风险预警与监控)
4.  [用户体验设计](#4-用户体验设计)
    -   [4.1 设计原则](#41-设计原则)
    -   [4.2 核心交互要求](#42-核心交互要求)
5.  [快速参考](#5-快速参考)
    -   [5.1 核心验收标准](#51-核心验收标准)
    -   [5.2 关键术语](#52-关键术语)

---

## 1. 产品概述

### 1.1 项目背景
当前，四川分公司在车险业务经营中面临变动成本管控的挑战。各环节数据分散、口径不一，导致成本核算效率低下，风险识别滞后。为应对市场竞争和监管要求，亟需构建一套自动化的变动成本明细分析系统，实现数据驱动的精细化管理。

### 1.2 核心目标
- **目标一：成本核算自动化** - 建立统一的数据标准和计算引擎，实现变动成本的自动、精准核算。
- **目标二：风险智能预警** - 通过对关键指标的实时监控，提前识别高风险业务单元，支撑主动风险干预。
- **目标三：决策支持可视化** - 提供多维度、交互式的分析仪表盘，为管理层提供直观、可靠的决策依据。

### 1.3 关键指标
- **变动成本率**: 核心衡量指标，反映业务的综合成本水平。
- **满期赔付率**: 评估承保质量和风险水平的关键指标。
- **费用率**: 监控各项业务费用的支出效率。
- **边际贡献率**: 衡量业务盈利能力的核心指标。

> **详细指标定义**: 请参考 [多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md)。

## 2. 产品愿景与北极星指标

### 2.1 产品愿景
让业务人员与精算/数据团队在同一块看板上"对齐事实、对齐口径、对齐行动"，用最少的操作获得可复用的洞察。

### 2.2 北极星指标

**一次分析路径全流程完成时间 ≤ 30秒**
- 选择维度 → 指标 → 图表 → 导出的完整流程
- 从用户操作开始到获得可用结果的端到端时间
- 包含数据加载、图表渲染、交互响应的总时间

**同一维度/指标的复用率 ≥ 60%**
- 统计周期内重复使用相同维度组合或指标组合的比例
- 体现分析模板和快捷配置的有效性
- 促进标准化分析流程的建立

---

## 2. AI核心处理逻辑

本系统的核心是AI驱动的数据处理与分析引擎，其逻辑对AI高度优化，以确保可解释性、可维护性和高效迭代。

### 2.1 数据预处理与转换
- **输入**: 多源异构数据（保单、赔案、费用等）。
- **处理**:
    1.  **数据清洗**: 处理缺失值、异常值和不一致数据。
    2.  **字段映射**: 根据 [多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md) 中的字段定义，将源数据字段标准化。
    3.  **数据类型转换**: 确保所有字段符合数据库存储要求。
- **输出**: 标准化、干净的数据集，供计算引擎使用。

### 2.2 指标计算引擎
- **输入**: 预处理后的数据集。
- **处理**:
    1.  **公式实现**: 严格按照 [多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md) 中定义的计算方法，计算各项核心指标。
    2.  **精度控制**: 遵循统一的精度要求，确保计算结果的准确性。
    3.  **口径统一**: 严格按照字段定义与计算规范中的口径共识执行计算
        - 满期出险率统一口径：(赔案件数 ÷ 保单件数) × (满期保费 ÷ 签单保费)
        - 变动成本率统一口径：(费用金额 ÷ 签单保费) + (已报告赔款 ÷ 满期保费)
        - 商业险自主系数仅适用于insurance_type = '商业保险'，保费加权计算，保留4位小数
    4.  **先聚合后计算**: 所有比率指标基于聚合后的绝对值重新计算，确保准确性。
- **输出**: 包含所有19个核心指标的完整结果集（9个绝对值字段+7个率值字段+2个均值字段+1个系数字段）。

#### 2.2.1 字段分类体系

严格按照 [多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md) 中定义的字段分类体系：

## 筛选维度字段（17个）

### 时间维度
| 中文名称 | 英文字段名 | 数据类型 | 示例值 | 业务含义 |
|----------|------------|----------|--------|---------|
| 数据快照日期 | `snapshot_date` | 日期 | 2025-07-13 | 数据快照日期，用于版本控制 |
| 保单起期年度 | `policy_start_year` | 整数 | 2024, 2025 | 保单起期年度，用于年度分析 |
| 周序号 | `week_number` | 整数 | 28, 29, 30, 31, 33, 34, 35, 36 | 周序号，用于周度分析 |

### 机构维度
| 中文名称 | 英文字段名 | 数据类型 | 主要选项 | 业务含义 |
|----------|------------|----------|----------|---------|
| 机构层级 | `chengdu_branch` | 字符串 | 成都, 中支 | 机构层级分类 |
| 三级机构 | `third_level_organization` | 字符串 | 乐山, 天府, 宜宾, 德阳等 | 具体经营机构 |

### 业务维度
| 中文名称 | 英文字段名 | 数据类型 | 主要选项 | 业务含义 |
|----------|------------|----------|----------|---------|
| 业务类型分类 | `business_type_category` | 字符串 | 10吨以上-普货, 非营业客车新车等 | 业务类型细分 |
| 客户三级分类 | `customer_category_3` | 字符串 | 营业货车, 非营业个人客车等 | 客户类型分类 |
| 险种类型 | `insurance_type` | 字符串 | 商业保险, 交强险 | 险种分类 |
| 险别组合 | `coverage_type` | 字符串 | 主全, 交三, 单交 | 险别组合类型 |
| 新续转状态 | `renewal_status` | 字符串 | 新保, 续保, 转保 | 保单续保状态 |
| 投保终端来源 | `terminal_source` | 字符串 | 0101柜面, 0105微信等 | 投保渠道来源 |

### 车辆属性维度
| 中文名称 | 英文字段名 | 数据类型 | 主要选项 | 业务含义 |
|----------|------------|----------|----------|---------|
| 是否新能源车 | `is_new_energy_vehicle` | 布尔 | True, False | 新能源车标识 |
| 是否过户车 | `is_transferred_vehicle` | 布尔 | True, False | 过户车标识 |

### 风险评级维度
| 中文名称 | 英文字段名 | 数据类型 | 主要选项 | 业务含义 |
|----------|------------|----------|----------|---------|
| 车险分等级 | `vehicle_insurance_grade` | 字符串 | A, B, C, D, E, F, G, X | 车险风险等级 |
| 高速风险等级 | `highway_risk_grade` | 字符串 | A, B, C, D, E, X | 高速行驶风险等级 |
| 大货车评分 | `large_truck_score` | 字符串 | A, B, C, D, E, X | 大货车风险评分 |
| 小货车评分 | `small_truck_score` | 字符串 | A, B, C, D, E, X | 小货车风险评分 |

## 绝对值字段（9个）- 聚合计算基础

### 签单保费 | `signed_premium_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 保险公司实际承保的保费总额，体现承保规模与业务产能
- **计算公式**: 直接聚合求和 `SUM(signed_premium_yuan)`
- **注意事项**: 用于计算费用率、变动成本率等关键指标的分母

### 满期保费 | `matured_premium_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 已满期责任对应的净保费，用于计算赔付率和边际贡献
- **计算公式**: 直接聚合求和 `SUM(matured_premium_yuan)`
- **注意事项**: 与签单保费的差异反映退保、批改等影响

### 商业险折前保费 | `commercial_premium_before_discount_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 商业险优惠前的保费金额，用于计算自主定价系数
- **计算公式**: 直接聚合求和 `SUM(commercial_premium_before_discount_yuan)`
- **注意事项**: 仅适用于商业险，交强险此字段为0

### 保单件数 | `policy_count`
- **数据类型**: 整数 | **单位**: 件 | **分类标签**: 绝对值字段
- **业务含义**: 保单数量，用于计算单均保费、满期出险率等
- **计算公式**: 直接聚合求和 `SUM(policy_count)`
- **注意事项**: 用于各类均值指标的分母

### 赔案件数 | `claim_case_count`
- **数据类型**: 整数 | **单位**: 件 | **分类标签**: 绝对值字段
- **业务含义**: 发生理赔的案件总数，用于计算案均赔款、满期出险率
- **计算公式**: 直接聚合求和 `SUM(claim_case_count)`
- **推导公式**: `(reported_claim_payment_yuan × 10000) ÷ average_claim_payment_yuan`

### 已报告赔款 | `reported_claim_payment_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 已实际支付的累计赔款金额，反映业务风险成本总额
- **计算公式**: 直接聚合求和 `SUM(reported_claim_payment_yuan)`
- **注意事项**: 用于计算满期赔付率、变动成本率的重要组成部分

### 费用金额 | `expense_amount_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 运营和管理费用总额，用于计算费用率和变动成本率
- **计算公式**: 直接聚合求和 `SUM(expense_amount_yuan)`
- **推导公式**: `signed_premium_yuan × expense_ratio_percent ÷ 100`

### 保费计划 | `premium_plan_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 预设的保费收入目标，用于计算保费时间进度达成率
- **计算公式**: 直接聚合求和 `SUM(premium_plan_yuan)`
- **注意事项**: 按日计算进度，支持时间进度管理

### 满期边际贡献额 | `marginal_contribution_amount_yuan`
- **数据类型**: 浮点数 | **单位**: 元 | **分类标签**: 绝对值字段
- **业务含义**: 保费收入扣除变动成本后的绝对金额，直接反映业务盈利能力
- **计算公式**: `SUM(matured_premium_yuan) × (1 - 满期赔付率 - 费用率)`
- **详细计算**: `SUM(matured_premium_yuan) × (1 - SUM(reported_claim_payment_yuan)/SUM(matured_premium_yuan) - SUM(expense_amount_yuan)/SUM(signed_premium_yuan))`
- **重要说明**: 这是满期边际贡献额，并非终极边际贡献额。只有当统计区间内所有车险保单均满期且所有赔案完全结案后，才能计算出终极边际贡献额
- **注意事项**: 用于盈利能力评估、业务价值分析，与边际贡献率相互验证

## 率值字段（7个）- 公式计算

### 费用率 | `expense_ratio_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 费用占签单保费的比例，衡量费用管控能力
- **计算公式**: `(SUM(expense_amount_yuan) ÷ SUM(signed_premium_yuan)) × 100`
- **展示精度**: 保留1位小数
- **正常范围**: 通常在5%-30%之间

### 满期率 | `maturity_ratio_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 满期保费占签单保费的比例，反映保单满期情况
- **计算公式**: `(SUM(matured_premium_yuan) ÷ SUM(signed_premium_yuan)) × 100`
- **展示精度**: 保留1位小数
- **正常范围**: 通常在80%-100%之间

### 满期出险率 | `claim_frequency_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 每张保单在满期责任范围内发生赔案的频率
- **计算公式**: `(SUM(claim_case_count) ÷ SUM(policy_count)) × (SUM(matured_premium_yuan) ÷ SUM(signed_premium_yuan)) × 100`
- **展示精度**: 保留1位小数
- **注意事项**: 包含满期率修正系数，更真实反映风险暴露程度

### 满期赔付率 | `matured_loss_ratio_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 赔款与满期保费的比率，衡量承保业务的风险成本水平
- **计算公式**: `(SUM(reported_claim_payment_yuan) ÷ SUM(matured_premium_yuan)) × 100`
- **展示精度**: 保留1位小数
- **正常范围**: 通常在40%-80%之间

### 变动成本率 | `variable_cost_ratio_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 变动成本占签单保费的比例，衡量业务整体成本水平
- **计算公式**: `(SUM(expense_amount_yuan) ÷ SUM(signed_premium_yuan) + SUM(reported_claim_payment_yuan) ÷ SUM(matured_premium_yuan)) × 100`
- **展示精度**: 保留1位小数
- **组成部分**: (费用金额 ÷ 签单保费) + (已报告赔款 ÷ 满期保费)
- **说明**: 该指标用于精确计算每单位已满期保单的保费收入所对应的变动成本比例，确保公式一致性和计算准确性

### 边际贡献率 | `marginal_contribution_ratio_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 保费收入扣除变动成本后的比例，衡量业务盈利空间
- **计算公式**: `(SUM(marginal_contribution_amount_yuan) ÷ SUM(matured_premium_yuan)) × 100`
- **推导公式**: `100 - matured_loss_ratio_percent - (SUM(expense_amount_yuan) / SUM(matured_premium_yuan)) * 100`
- **简化表达**: `1 - 满期赔付率 - 费用率(基于满期保费)`
- **展示精度**: 保留1位小数
- **互补关系**: 与变动成本率（基于满期保费）互补

### 保费时间进度达成率 | `premium_time_progress_achievement_rate_percent`
- **数据类型**: 浮点数 | **单位**: % | **分类标签**: 率值字段
- **业务含义**: 签单保费与保费时间进度计划的比率，衡量计划执行情况
- **计算公式**: `(SUM(signed_premium_yuan) ÷ SUM(premium_time_progress_plan_yuan)) × 100`
- **展示精度**: 保留1位小数
- **注意事项**: 保费时间进度计划按日计算进度，支持精细化管理

## 均值字段（2个）- 公式计算

### 单均保费 | `average_premium_per_policy_yuan`
- **数据类型**: 浮点数 | **单位**: 元/件 | **分类标签**: 均值字段
- **业务含义**: 平均每张保单的保费金额，反映业务结构和客户质量
- **计算公式**: `SUM(signed_premium_yuan) ÷ SUM(policy_count)`
- **展示精度**: 保留整数
- **应用场景**: 业务结构分析、客户价值评估

### 案均赔款 | `average_claim_payment_yuan`
- **数据类型**: 浮点数 | **单位**: 元/件 | **分类标签**: 均值字段
- **业务含义**: 平均每个理赔案件的赔款金额，反映案件严重程度
- **计算公式**: `SUM(reported_claim_payment_yuan) ÷ SUM(claim_case_count)`
- **展示精度**: 保留整数
- **应用场景**: 理赔成本分析、风险评估

## 系数字段（1个）

### 商业险自主系数 | `commercial_auto_underwriting_factor`
- **数据类型**: 浮点数 | **单位**: 系数 | **分类标签**: 系数字段
- **业务含义**: 商业险自主定价系数，反映定价策略和风险评估
- **计算公式**: `SUM(signed_premium_yuan) ÷ SUM(commercial_premium_before_discount_yuan)`
- **展示精度**: 保留4位小数
- **适用范围**: 仅适用于商业险，交强险不适用
- **正常范围**: 通常在0.6-1.0之间

#### 2.2.2 统一精度要求

严格遵循 [多维分析系统数据说明](./多维分析系统数据规范/多维分析系统数据说明.md) 中的精度规范：

- **绝对值类**（保费、赔款、费用、满期边际贡献额）：numeric(18,4)，展示取整，单位万元或元
- **率/比率类**（满期出险率、满期赔付率、费用率、变动成本率、边际贡献率、保费计划达成率）：numeric(10,6)，存库为小数，展示保留1位小数
- **件数类**（policy_count, case_count）：bigint，展示为整数
- **系数类**（commercial_auto_underwriting_factor）：numeric(12,6)，展示保留4位小数

#### 2.2.3 异常值处理规则

- 分母为0时返回NULL或0
- 结果超出合理区间（如成本率>100%或贡献率<0）需提示校验

#### 2.2.4 数据架构概述

**数据规模特征**:
- **筛选维度**: 17个维度字段，支持多维度组合筛选
- **核心指标**: 18个计算字段（9个绝对值 + 7个率值 + 2个均值）
- **系数指标**: 1个定价系数字段
- **数据粒度**: 支持日、周、月、年等多时间粒度分析
- **机构层级**: 支持省、市、县三级机构维度

**代码计算机制**:
- **聚合计算**: 绝对值字段采用SUM聚合
- **公式计算**: 率值和均值字段基于聚合结果通过代码计算
- **缓存策略**: 高频查询结果缓存5分钟
- **增量更新**: 支持数据增量更新和重算

**数据重构特点**:
- **字段标准化**: 所有字段名称、类型、计算公式完全标准化
- **业务语义化**: 字段命名体现明确的业务含义
- **计算透明化**: 所有计算公式公开透明，可追溯验证
- **扩展性设计**: 预留字段扩展空间，支持业务发展需求

### 2.3 智能分析与洞察
- **输入**: 指标结果集和历史数据。
- **处理**:
    1.  **异常检测**: 基于字段定义与计算规范异常值处理规则识别指标异常
        - 满期赔付率 > 70% 时标记异常预警
        - 费用率 > 15% 或 < 5% 时标记异常  
        - 变动成本率 > 92% 时标记高风险预警
        - 边际贡献率 < 8% 时标记异常
        - 保费时间进度达成率 < 95% 时标记进度预警
        - 分母为0的指标自动返回NULL并提示数据缺失
    2.  **趋势分析**: 分析关键指标的时间序列变化，识别上升或下降趋势。
    3.  **归因分析**: 初步探索导致指标异常的可能维度（如特定机构、特定险种）。
    4.  **智能洞察生成**: 基于数据变化自动生成三段式分析报告。
- **输出**: 可视化图表、风险预警通知、智能分析报告。

#### 2.3.1 AI智能洞察算法

**三段式分析报告生成**:
1. **趋势分析段**:
   - 解读核心成本指标的变化趋势
   - 识别关键指标的周环比、月环比变化
   - 分析变化背后的可能原因

2. **异常识别段**:
   - 自动检测显著偏离正常范围的指标
   - 识别异常数据点并标注可能原因
   - 提供异常指标的影响程度评估

3. **业务洞察段**:
   - 基于数据分析提供2-3个具体的业务优化建议
   - 针对高风险业务单元提出管控建议
   - 为决策层提供可执行的行动方案

#### 2.3.2 异常检测机制

**阈值设定**:
- **变动成本率**: >80% 为高风险预警
- **满期赔付率**: >70% 为异常预警
- **费用率**: >30% 或 <5% 为费用异常
- **保费时间进度达成率**: <80% 为进度预警
- **边际贡献率**: <20% 为盈利能力预警

**预警级别**:
- 🔴 **严重**: 指标偏离正常范围>30%
- 🟡 **警告**: 指标偏离正常范围10-30%
- 🟢 **正常**: 指标在正常范围内

#### 2.3.3 智能推荐算法

**推荐逻辑**:
1. **基于历史数据**: 分析相似情况下的成功经验
2. **基于同业对比**: 参考行业标杆的最佳实践
3. **基于风险评估**: 优先推荐风险可控的优化方案

---

## 3. 功能架构

### 3.1 功能架构图

```
车险变动成本明细分析系统
├── 数据层 (Data Layer)
│   ├── 数据导入模块
│   ├── 数据清洗与转换
│   └── 数据存储与管理
├── 业务逻辑层 (Business Logic Layer)
│   ├── 指标计算引擎
│   ├── 多维度筛选引擎
│   └── AI智能分析引擎
├── 交互层 (Interaction Layer)
│   ├── 多维度筛选系统
│   ├── 核心指标看板 (KPI Dashboard)
│   ├── 三大选择器系统
│   └── 图表画布与交互系统
└── 智能服务层 (Intelligence Layer)
    ├── AI智能洞察
    ├── 异常检测与预警
    └── 智能推荐与优化建议
```

### 3.2 核心功能模块

#### 3.2.1 多维度筛选系统
**功能描述**: 提供17个维度的组合筛选功能，以弹窗形式展示。
- **触发方式**: 点击页面头部的"筛选器"按钮。
- **交互**: 弹窗内展示所有筛选维度，用户可进行多选。点击"应用筛选"后，弹窗关闭，仪表板根据新条件刷新。
- **维度**: 严格遵循《车险字段定义与计算规范.md》定义的17个筛选维度。

#### 3.2.2 核心指标看板 (KPI)
**功能描述**: 在仪表盘主区域以灵活网格布局，集中展示19个核心KPI指标。
- **布局**: 响应式网格布局，清晰展示19个核心指标，按字段分类组织。
- **数据逻辑**: 所有KPI计算均基于筛选器中选定的**单一周**的数据。
- **对比逻辑**: 对比数据为筛选周的**前一周**，实现周环比对比。
- **指标列表**（严格按照字段定义与计算规范）:
  
  **绝对值字段（9个）**:
   1. 签单保费(元)
   2. 满期保费(元)
   3. 商业险折前保费(元)
   4. 保单件数(件)
   5. 赔案件数(件)
   6. 已报告赔款(元)
   7. 费用金额(元)
   8. 保费计划(元)
   9. 满期边际贡献额(元)
  
  **率值字段（7个）**:
  9. 费用率(%)
  10. 满期率(%)
  11. 满期出险率(%)
  12. 满期赔付率(%)
  13. 变动成本率(%)
  14. 边际贡献率(%)
  15. 保费时间进度达成率(%)
  
  **均值字段（2个）**:
  16. 单均保费(元/件)
  17. 案均赔款(元/件)
  
  **系数字段（1个）**:
   19. 商业险自主系数
  
- **展示**: 每个指标卡片清晰展示指标名称、当前值、与上一周的差异绝对值和百分比。

#### 3.2.3 AI智能洞察
**功能描述**: 提供一个独立的AI分析模块，对当前筛选条件下的数据进行深度分析。
- **触发方式**: 用户在AI洞察模块中点击"分析成本趋势"按钮。
- **分析内容**: AI将基于当前看板展示的KPI数据和时间序列，用中文生成三段式分析报告：
  1. **趋势分析**: 解读核心成本指标的变化趋势及背后原因。
  2. **异常识别**: 识别数据中的显著异常点并分析可能原因。
  3. **业务洞察**: 提供2-3个具体、可执行的业务优化建议。

### 3.3 支撑功能模块

#### 3.3.1 数据导入
**功能描述**: 允许用户上传最新的周报数据。
- **触发方式**: 点击页面头部的"导入数据"按钮。
- **交互**: 弹出对话框，用户需指定"起保年度"和"周序号"，并选择对应的CSV文件进行上传。
- **后端逻辑**: 上传的文件将按 `/{年份}年保单/{年份}年保单截至{周次}周数据.csv` 的格式存储在服务器的 `data/` 目录下。

---

## 4. 核心功能需求

### 3.1 数据导入与集成

#### 3.1.1 CSV文件上传功能

**上传规范要求**:
- **文件格式**: 仅支持CSV格式，编码为UTF-8
- **文件大小**: 单文件最大100MB，支持批量上传
- **字段规范**: 严格按照 [上传CSV文件字段规范](./多维分析系统数据规范/上传CSV文件字段规范.md) 执行
- **必需字段**: 17个筛选维度字段 + 9个绝对值字段，共26个必需字段
- **字段顺序**: 不强制要求字段顺序，但建议按规范文档顺序排列

**数据验证机制**:
- **字段完整性检查**: 验证所有必需字段是否存在
- **数据类型验证**: 检查每个字段的数据类型是否符合规范
- **数值范围验证**: 验证数值字段是否在合理范围内
- **枚举值验证**: 检查分类字段的值是否在预定义选项范围内
- **业务逻辑验证**: 验证字段间的业务逻辑关系（如满期保费≤签单保费）

**错误处理与反馈**:
- **实时验证**: 上传过程中实时显示验证进度和错误信息
- **错误报告**: 生成详细的错误报告，包含错误行号、字段名、错误类型
- **部分导入**: 支持跳过错误行，导入正确的数据行
- **修复建议**: 提供数据修复建议和常见错误解决方案

#### 3.1.2 数据预处理与清洗

**自动数据清洗**:
- **空值处理**: 自动识别和处理空值、NULL值、空字符串
- **格式标准化**: 统一日期格式、数值格式、字符串格式
- **重复数据检测**: 基于关键字段组合检测重复记录
- **异常值识别**: 基于统计方法识别异常值和离群点

**数据质量评估**:
- **完整性评分**: 计算数据完整性得分（0-100分）
- **准确性评分**: 基于业务规则评估数据准确性
- **一致性检查**: 验证数据内部逻辑一致性
- **及时性评估**: 检查数据时效性和更新频率

#### 3.1.3 增量数据更新

**更新策略**:
- **全量替换**: 支持完全替换现有数据集
- **增量追加**: 基于时间戳追加新数据
- **智能合并**: 基于业务键智能合并新旧数据
- **版本管理**: 保留历史版本，支持数据回滚

**冲突处理**:
- **重复键处理**: 提供覆盖、跳过、合并三种处理策略
- **数据冲突解决**: 基于时间戳或优先级解决数据冲突
- **变更追踪**: 记录所有数据变更历史和操作日志

- **需求**: 支持从不同业务系统（如核心承保系统、理赔系统）自动或手动导入数据。
- **验收关键**: 数据导入后能被AI核心处理逻辑正确识别和处理。

### 3.2 三大选择器系统

#### 3.2.1 维度选择器 (Dimension Picker)
**可选维度（按实际字段落地）**:
- **时间维度**: snapshot_date、week_number、policy_start_year
- **机构维度**: chengdu_branch、third_level_organization
- **业务维度**: business_type_category、customer_category_3、insurance_type、coverage_type、renewal_status、terminal_source
- **车辆属性维度**: is_new_energy_vehicle、is_transferred_vehicle
- **风险评级维度**: vehicle_insurance_grade、highway_risk_grade、large_truck_score、small_truck_score

**核心特性**:
- **多选+排序**: 顺序影响分组/分面优先级，支持拖拽调整
- **级联选择**: chengdu_branch → third_level_organization，智能联动
- **快捷模板**: 默认组合（week_number + chengdu_branch + insurance_type），支持自定义保存
- **历史记录**: 最近使用的维度组合（TOP5），一键应用
- **智能推荐**: 基于当前数据特征推荐最佳维度组合

#### 3.2.2 筛选维度详细配置

**时间维度筛选**:
- **数据快照日期**: 支持单日或日期范围选择，最长支持5年历史数据
- **保单起期年度**: 支持多年度选择和对比分析
- **周序号**: 支持周度分析和周同比，自动计算对比周期

**机构维度筛选**:
- **机构层级**: 成都/中支层级筛选，支持层级对比
- **三级机构**: 支持具体经营机构的精确筛选，提供搜索功能

**业务维度筛选**:
- **业务类型分类**: 支持多业务类型组合筛选，智能分组展示
- **客户三级分类**: 按客户类型进行精准筛选，支持客户画像分析
- **险种类型**: 商业保险/交强险分类筛选，支持险种对比
- **险别组合**: 主全/交三/单交等组合筛选，支持组合效果分析
- **新续转状态**: 新保/续保/转保状态筛选，支持客户生命周期分析
- **投保终端来源**: 按渠道来源进行筛选，支持渠道效果评估

**车辆属性筛选**:
- **是否新能源车**: 布尔值筛选，支持新能源车专项分析和政策影响评估
- **是否过户车**: 布尔值筛选，支持过户车风险分析和定价策略

**风险评级筛选**:
- **车险分等级**: A-G及X等级的多选筛选，支持风险分层分析
- **高速风险等级**: 高速行驶风险等级筛选，支持高速场景风险评估
- **大货车评分**: 大货车专项风险评分筛选，支持货运风险管控
- **小货车评分**: 小货车专项风险评分筛选，支持轻型货运分析

#### 3.2.3 筛选交互与体验

**筛选状态管理**:
- **实时预览**: 筛选条件变更时实时显示影响的数据量和覆盖率
- **条件展示**: 清晰展示当前生效的所有筛选条件，支持标签化管理
- **快速修改**: 支持直接点击筛选标签进行快速修改或删除
- **历史记录**: 保存最近10次筛选历史，支持快速恢复和对比

**性能优化**:
- **智能缓存**: 常用筛选组合结果缓存5分钟，提升响应速度
- **分页加载**: 大数据量时采用分页或虚拟滚动，单次最多15周数据
- **异步处理**: 复杂筛选异步处理，避免界面卡顿
- **进度提示**: 长时间查询显示进度条和预估完成时间

#### 3.2.2 指标选择器系统

**指标分类展示**:
- **绝对值指标（9个）**: 签单保费、满期保费、商业险折前保费、保单件数、赔案件数、已报告赔款、费用金额、保费计划、满期边际贡献额
- **率值指标（7个）**: 费用率、满期率、满期出险率、满期赔付率、变动成本率、边际贡献率、保费时间进度达成率
- **均值指标（2个）**: 单均保费、案均赔款
- **系数指标（1个）**: 商业险自主系数

**指标选择功能**:
- **多选模式**: 支持同时选择多个指标进行对比分析
- **指标搜索**: 提供指标名称和业务含义的模糊搜索
- **分类筛选**: 按指标类型快速筛选相关指标
- **常用指标**: 智能推荐和保存常用指标组合
- **指标详情**: 鼠标悬停显示指标的计算公式和业务含义

**指标计算说明**:
- **实时计算**: 所有率值、均值、系数指标基于当前筛选条件实时计算
- **公式透明**: 每个计算指标都显示完整的计算公式
- **精度控制**: 严格按照字段精度要求显示结果
- **异常处理**: 对除零、空值等异常情况进行友好提示

#### 3.2.3 图表类型选择器

**图表类型支持**:
- **柱状图**: 适用于分类数据对比，支持分组和堆叠
- **折线图**: 适用于趋势分析，支持多指标对比
- **饼图**: 适用于占比分析，支持环形图展示
- **散点图**: 适用于相关性分析，支持气泡图模式
- **热力图**: 适用于多维度交叉分析
- **表格**: 适用于精确数值展示和导出

**默认推荐逻辑**:
- **时间维度**: 自动推荐折线图进行趋势分析
- **分类维度**: 自动推荐柱状图进行对比分析
- **占比分析**: 自动推荐饼图展示结构分布
- **多维交叉**: 自动推荐热力图或分面图表

**交互特性**:
- **图表切换**: 支持在不同图表类型间快速切换
- **参数调整**: 支持图表参数的实时调整（如颜色、标签等）
- **响应式设计**: 图表自适应不同屏幕尺寸
- **导出功能**: 支持图表导出为PNG、PDF、Excel等格式

### 3.3 图表画布与交互系统

#### 3.3.1 字段映射规范
**标准映射关系**:
- **X轴**: 时间（week_number/snapshot_date）或类别维度
- **Y轴**: 金额/比率/频度指标
- **Color**: insurance_type/coverage_type/renewal_status 等分类维度
- **Size**（可选）: policy_count/claim_case_count/signed_premium_yuan 等数值维度

#### 3.3.2 联动刷选功能
**交互逻辑**:
- 在热力图选中"天府×商业保险" → 其他图表同步过滤
- 支持多图表联动，保持筛选条件一致性
- 提供"清除筛选"和"锁定筛选"功能

#### 3.3.3 智能标注系统
**自动标注**:
- 对异常周（满期赔付率>70%）自动高亮显示
- 异常值自动添加警告标识
- 趋势拐点自动标记

**人工批注**:
- 支持用户在图表上添加文字批注
- 批注可保存并在导出时包含
- 支持批注的编辑和删除

#### 3.3.4 导出功能
**导出格式**:
- 图表导出：PNG/SVG格式
- 数据导出：CSV格式表格

**导出增强**:
- 导出时自动附加"口径版本+过滤条件"信息
- 包含数据生成时间戳
- 支持批量导出多个图表

### 3.4 成本分析仪表盘
- **需求**: 提供一个高度交互式的仪表盘，展示核心指标，并支持多维度（时间、机构、险种）的下钻和筛选。
- **验收关键**: 仪表盘数据与AI计算结果完全一致，交互流畅。

### 3.5 风险预警与监控
- **需求**: 当关键风险指标（如变动成本率）超过阈值时，系统能通过邮件或应用内通知发送预警。
- **验收关键**: 预警触发及时、准确，通知内容清晰。

---

## 4. 用户体验设计

### 4.1 设计原则
- **数据驱动**: 所有界面设计都应服务于数据的清晰展示和快速解读。
- **简洁直观**: 避免信息过载，突出核心指标和关键洞察。
- **高效操作**: 减少用户点击次数，提供流畅的分析路径。

### 4.2 核心交互要求
- **全局筛选**: 提供全局日期、机构筛选器。
- **图表联动**: 点击仪表盘的某个模块，其他模块数据应相应更新。
- **数据导出**: 支持将分析结果导出为Excel或CSV格式。

> **详细设计规范**: 请参考外部UI/UX设计文档。

---

## 5. 快速参考

### 5.1 核心验收标准
- **数据准确性**: 计算结果与现有验证报告100%一致
- **性能要求**: 单文件加载<5秒，KPI计算<1秒，页面首次渲染<3秒
- **用户体验**: 界面响应流畅，操作直观易懂，苹果发布会风格设计
- **代码质量**: 完整TypeScript类型，中文注释，遵循最佳实践
- **AI智能化**: 三段式分析报告，异常预警系统，智能推荐功能

### 5.2 开发阶段规划

#### Phase 1: MVP核心功能（当前阶段）
**目标**: 快速验证核心价值，2周内完成

**必须实现的功能**:
1. **数据加载模块**: 读取单个CSV文件，数据类型转换和验证，基础错误处理
2. **指标计算引擎**: 实现19个核心指标计算逻辑（9个绝对值字段+7个率值字段+2个均值字段+1个系数字段），支持数据聚合和比率重算
3. **核心指标看板**: 响应式网格布局，三大选择器系统，图表画布与交互
4. **AI智能洞察**: 三段式分析报告，异常检测，智能推荐
5. **数据验证**: 与现有计算验证报告对比，确保准确性

### 5.3 技术架构目录结构
```
src/
├── components/          # React组件
│   ├── dashboard/      # 仪表板组件
│   │   ├── KPIGrid.tsx # 4x4指标网格
│   │   └── AIInsights.tsx # AI洞察面板
│   ├── selectors/      # 选择器组件
│   │   ├── DimensionSelector.tsx # 维度选择器
│   │   ├── MetricSelector.tsx    # 指标选择器
│   │   └── ChartSelector.tsx     # 图表选择器
│   ├── charts/         # 图表组件
│   │   └── ChartCanvas.tsx # 图表画布
│   └── common/         # 通用组件
│       ├── DataLoader.tsx # 数据加载
│       └── MetricCard.tsx # 指标卡片
├── services/           # 业务逻辑
│   ├── dataProcessor.ts # 数据处理
│   ├── metricCalculator.ts # 指标计算
│   ├── aiAnalyzer.ts   # AI分析引擎
│   └── csvParser.ts    # CSV解析
├── types/              # TypeScript类型定义
│   ├── insurance.ts    # 保险业务类型
│   └── metrics.ts      # 指标类型定义
└── utils/              # 工具函数
    ├── calculations.ts # 计算工具
    └── formatters.ts   # 格式化工具
```

### 5.4 交付要求

#### 代码交付
- 完整的源代码，包含详细的中文注释
- 可运行的开发环境配置
- 基础的单元测试

#### 文档交付
- 开发说明文档
- API接口文档
- 部署指南

#### 验证交付
- 与现有计算结果的对比验证
- 性能测试报告
- 功能演示视频或截图

### 5.5 关键术语
- **签单保费**: 保险公司实际承保的保费金额
- **满期保费**: 已满期责任对应的净保费，用于计算赔付率和满期边际贡献
- **变动成本率**: (费用金额 ÷ 签单保费) + (已报告赔款 ÷ 满期保费)，用于精确计算每单位已满期保单的保费收入所对应的变动成本比例
- **边际贡献率**: 保费收入扣除变动成本后的比例，衡量业务盈利空间
- **先聚合后计算**: 所有比率指标基于聚合后绝对值重新计算的原则
- **三段式分析报告**: 趋势分析、异常识别、业务洞察三个模块的AI分析报告

> **完整数据规范**: 请参考 [多维分析系统数据规范](./多维分析系统数据规范/) 目录下的相关文档。

---
**文档版本**: v2.0 | **最后更新**: 2025-09-15